<div class="govuk-tabs__panel hackney-work-order-tabs-info" id="repair-history-tab">
  <h1 class="govuk-heading-l">
    Repairs history
  </h1>

  <% if dwelling_work_orders_hierarchy.any? %>
  <ul class="hackney-filtering__list">
    <% dwelling_work_orders_hierarchy.keys.each_with_index do |description, index| %>
      <li>
        <strong onClick="applyBuildingFilter('<%= description.parameterize %>-tab', '<%= description.parameterize %>-content')" class="tabelement hackney-filtering__tag <%= "hackney-filtering__tag--active" if index == 0 %>" id="<%= description.parameterize %>-tab"><%= description %></strong>
      </li>
    <% end %>
  </ul>

  <div class="govuk-grid-row">
    <%= render 'work_orders/repair_history_filter_by_trade', work_orders_trades: trades %>

    <% dwelling_work_orders_hierarchy.each_with_index do |(description, work_orders), index| %>
      <div class="tabcontent <%= 'hidden' unless index == 0 %>" id="<%= description.parameterize %>-content">
        <h2 class="heading-large">
          <%= description %>
        </h2>

        <div class="govuk-grid-column-three-quarters">
          <table class="govuk-table hackney-history hackney-work-order-table">
            <thead class="govuk-table__head">
            <tr>
              <th class="govuk-table__header" scope="col">Reference</th>
              <th class="govuk-table__header" scope="col">Date raised</th>
              <th class="govuk-table__header" scope="col">Status</th>
              <th class="govuk-table__header" scope="col">Trade</th>
              <th class="govuk-table__header" scope="col">Description</th>
            </tr>
            </thead>
            <tbody class="govuk-table__body">
            <% work_orders.sort_by(&:created).reverse.each do |work_order| %>
              <tr class="govuk-table__row hackney-work-order-rows"
                  data-trade="trade-<%= trades.index(work_order.trade) %>">
                <td class="govuk-table__cell"><%= link_to work_order.reference, work_order_path(work_order.reference) %></td>
                <td class="govuk-table__cell hackney-work-order-date-raised">
                  <p class='work_order_date_created'><%= work_order.created.to_date.to_s(:govuk_date_short) %></p>
                  <p class='govuk-body-s work_order_time_created'><%= work_order.created.to_s(:govuk_time) %></p>
                </td>
                <td class="govuk-table__cell">
                  <span class="status status-<%= work_order.work_order_status %>">
                    <%= work_order_status_description(work_order.work_order_status).capitalize %>
                  </span>
                </td>
                <td class="govuk-table__cell description work-order-trade"><%= work_order.trade %></td>
                <td class="govuk-table__cell description"><%= work_order.problem_description %></td>
              </tr>
            <% end %>
            </tbody>
          </table>
        </div>
      </div>
    <% end %>
  </div>

  <% else %>
    <p class="govuk-body-s">There are no work orders.</p>
  <% end %>

</div>

<script>
  function applyBuildingFilter(tab_id, content_id) {
    var tabs = document.getElementsByClassName('tabelement');
    for(i = 0; i < tabs.length; i++) {
      tabs[i].className = 'tabelement hackney-filtering__tag';
    }
    document.getElementById(tab_id).className = 'tabelement hackney-filtering__tag hackney-filtering__tag--active';

    var tab_contents = document.getElementsByClassName('tabcontent');
    for(i = 0; i < tabs.length; i++) {
      var el = tab_contents[i];
      el.style.display = 'none';
      el.className = 'tabcontent';
    }
    document.getElementById(content_id).style.display = 'block';
  }
</script>
